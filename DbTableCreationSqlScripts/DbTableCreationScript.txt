-- DROP SCHEMA public;

CREATE SCHEMA public AUTHORIZATION postgres;

-- Drop table

-- DROP TABLE public."ContractDatas";

CREATE TABLE public."ContractDatas" (
	"Id" int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	"OriginalAmount" numeric NOT NULL,
	"InstallmentAmount" numeric NOT NULL,
	"CurrentBalanceId" numeric NOT NULL,
	"OverdueBalance" numeric NOT NULL,
	"DateOfLastPayment" timestamp NOT NULL,
	"NextPaymentDate" timestamp NOT NULL,
	"DateAccountOpened" timestamp NOT NULL,
	"RealEndDate" timestamp NOT NULL,
	"ContractId" int4 NOT NULL DEFAULT 0,
	"CurrencyId" int4 NOT NULL DEFAULT 0,
	"PhaseOfContractId" int4 NOT NULL DEFAULT 0,
	CONSTRAINT "PK_ContractDatas" PRIMARY KEY ("Id"),
	CONSTRAINT "FK_ContractDatas_Contracts_ContractId" FOREIGN KEY ("ContractId") REFERENCES public."Contracts"("Id") ON DELETE CASCADE,
	CONSTRAINT "FK_ContractDatas_Currencies_CurrencyId" FOREIGN KEY ("CurrencyId") REFERENCES public."Currencies"("Id") ON DELETE CASCADE,
	CONSTRAINT "FK_ContractDatas_PhaseOfContracts_PhaseOfContractId" FOREIGN KEY ("PhaseOfContractId") REFERENCES public."PhaseOfContracts"("Id") ON DELETE CASCADE
);
CREATE UNIQUE INDEX "IX_ContractDatas_ContractId" ON public."ContractDatas" USING btree ("ContractId");
CREATE INDEX "IX_ContractDatas_CurrencyId" ON public."ContractDatas" USING btree ("CurrencyId");
CREATE INDEX "IX_ContractDatas_PhaseOfContractId" ON public."ContractDatas" USING btree ("PhaseOfContractId");

-- Drop table

-- DROP TABLE public."Contracts";

CREATE TABLE public."Contracts" (
	"Id" int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	"ContractCode" text NULL,
	CONSTRAINT "PK_Contracts" PRIMARY KEY ("Id")
);

-- Drop table

-- DROP TABLE public."Currencies";

CREATE TABLE public."Currencies" (
	"Id" int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	"Name" text NULL,
	CONSTRAINT "PK_Currencies" PRIMARY KEY ("Id")
);

-- Drop table

-- DROP TABLE public."Individuals";

CREATE TABLE public."Individuals" (
	"Id" int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	"CustomerCode" text NULL,
	"FirstName" text NULL,
	"LastName" text NULL,
	"Gender" text NULL,
	"DateOfBirth" timestamp NOT NULL,
	"NationalID" text NULL,
	"ContractId" int4 NOT NULL DEFAULT 0,
	CONSTRAINT "PK_Individuals" PRIMARY KEY ("Id"),
	CONSTRAINT "FK_Individuals_Contracts_ContractId" FOREIGN KEY ("ContractId") REFERENCES public."Contracts"("Id") ON DELETE CASCADE
);
CREATE INDEX "IX_Individuals_ContractId" ON public."Individuals" USING btree ("ContractId");

-- Drop table

-- DROP TABLE public."PhaseOfContracts";

CREATE TABLE public."PhaseOfContracts" (
	"Id" int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	"Name" text NULL,
	CONSTRAINT "PK_PhaseOfContracts" PRIMARY KEY ("Id")
);

-- Drop table

-- DROP TABLE public."Roles";

CREATE TABLE public."Roles" (
	"Id" int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	"Name" text NULL,
	CONSTRAINT "PK_Roles" PRIMARY KEY ("Id")
);

-- Drop table

-- DROP TABLE public."SubjectRoles";

CREATE TABLE public."SubjectRoles" (
	"Id" int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	"GuaranteeAmount" numeric NULL,
	"IndividualId" int4 NOT NULL DEFAULT 0,
	"CurrencyId" int4 NOT NULL DEFAULT 0,
	"RoleId" int4 NOT NULL DEFAULT 0,
	CONSTRAINT "PK_SubjectRoles" PRIMARY KEY ("Id"),
	CONSTRAINT "FK_SubjectRoles_Currencies_CurrencyId" FOREIGN KEY ("CurrencyId") REFERENCES public."Currencies"("Id") ON DELETE CASCADE,
	CONSTRAINT "FK_SubjectRoles_Individuals_IndividualId" FOREIGN KEY ("IndividualId") REFERENCES public."Individuals"("Id") ON DELETE CASCADE,
	CONSTRAINT "FK_SubjectRoles_Roles_RoleId" FOREIGN KEY ("RoleId") REFERENCES public."Roles"("Id") ON DELETE CASCADE
);
CREATE INDEX "IX_SubjectRoles_CurrencyId" ON public."SubjectRoles" USING btree ("CurrencyId");
CREATE UNIQUE INDEX "IX_SubjectRoles_IndividualId" ON public."SubjectRoles" USING btree ("IndividualId");
CREATE INDEX "IX_SubjectRoles_RoleId" ON public."SubjectRoles" USING btree ("RoleId");

-- Drop table

-- DROP TABLE public."__EFMigrationsHistory";

CREATE TABLE public."__EFMigrationsHistory" (
	"MigrationId" varchar(150) NOT NULL,
	"ProductVersion" varchar(32) NOT NULL,
	CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY ("MigrationId")
);
